<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>ref &amp; reactive | Nx-website-component</title>
    <meta name="generator" content="VuePress 1.7.1">
    
    <meta name="description" content="Vue component for nx-website.">
    
    <link rel="preload" href="/docs/assets/css/0.styles.148f7da4.css" as="style"><link rel="preload" href="/docs/assets/js/app.fbbc5710.js" as="script"><link rel="preload" href="/docs/assets/js/2.f0b9337b.js" as="script"><link rel="preload" href="/docs/assets/js/102.e34730af.js" as="script"><link rel="prefetch" href="/docs/assets/js/10.487d35ae.js"><link rel="prefetch" href="/docs/assets/js/100.c1e8c00b.js"><link rel="prefetch" href="/docs/assets/js/101.b4f47aa5.js"><link rel="prefetch" href="/docs/assets/js/103.29e167b2.js"><link rel="prefetch" href="/docs/assets/js/104.c06225f7.js"><link rel="prefetch" href="/docs/assets/js/105.67c78d5e.js"><link rel="prefetch" href="/docs/assets/js/106.ae5b39bb.js"><link rel="prefetch" href="/docs/assets/js/107.47022ac4.js"><link rel="prefetch" href="/docs/assets/js/108.e0650c92.js"><link rel="prefetch" href="/docs/assets/js/109.cb1425e7.js"><link rel="prefetch" href="/docs/assets/js/11.6b5fc9f6.js"><link rel="prefetch" href="/docs/assets/js/110.74f32c0d.js"><link rel="prefetch" href="/docs/assets/js/111.2f8cc9e7.js"><link rel="prefetch" href="/docs/assets/js/112.63d69740.js"><link rel="prefetch" href="/docs/assets/js/12.0ac83021.js"><link rel="prefetch" href="/docs/assets/js/13.2b8c241e.js"><link rel="prefetch" href="/docs/assets/js/14.c010753d.js"><link rel="prefetch" href="/docs/assets/js/15.4da5f20b.js"><link rel="prefetch" href="/docs/assets/js/16.89e7c0ea.js"><link rel="prefetch" href="/docs/assets/js/17.b3ebb8fb.js"><link rel="prefetch" href="/docs/assets/js/18.c542a88e.js"><link rel="prefetch" href="/docs/assets/js/19.37ade9a2.js"><link rel="prefetch" href="/docs/assets/js/20.2f0b210c.js"><link rel="prefetch" href="/docs/assets/js/21.3272d07c.js"><link rel="prefetch" href="/docs/assets/js/22.3cb57d56.js"><link rel="prefetch" href="/docs/assets/js/23.70bc4901.js"><link rel="prefetch" href="/docs/assets/js/24.16310190.js"><link rel="prefetch" href="/docs/assets/js/25.5eea825c.js"><link rel="prefetch" href="/docs/assets/js/26.b2a19e56.js"><link rel="prefetch" href="/docs/assets/js/27.cdc87a5a.js"><link rel="prefetch" href="/docs/assets/js/28.4a0b9b9c.js"><link rel="prefetch" href="/docs/assets/js/29.cc81f5d5.js"><link rel="prefetch" href="/docs/assets/js/3.74f2d0c9.js"><link rel="prefetch" href="/docs/assets/js/30.c0c8d56f.js"><link rel="prefetch" href="/docs/assets/js/31.4733dc6e.js"><link rel="prefetch" href="/docs/assets/js/32.1a18df59.js"><link rel="prefetch" href="/docs/assets/js/33.4f2e541c.js"><link rel="prefetch" href="/docs/assets/js/34.d0243e65.js"><link rel="prefetch" href="/docs/assets/js/35.53b78448.js"><link rel="prefetch" href="/docs/assets/js/36.af38dfdd.js"><link rel="prefetch" href="/docs/assets/js/37.4685dcdc.js"><link rel="prefetch" href="/docs/assets/js/38.55fdf2ad.js"><link rel="prefetch" href="/docs/assets/js/39.bc2cb3c5.js"><link rel="prefetch" href="/docs/assets/js/4.d1ae9c7a.js"><link rel="prefetch" href="/docs/assets/js/40.adabc039.js"><link rel="prefetch" href="/docs/assets/js/41.f3e7aa0d.js"><link rel="prefetch" href="/docs/assets/js/42.c8bd2182.js"><link rel="prefetch" href="/docs/assets/js/43.55eba529.js"><link rel="prefetch" href="/docs/assets/js/44.a600d159.js"><link rel="prefetch" href="/docs/assets/js/45.beab6034.js"><link rel="prefetch" href="/docs/assets/js/46.a5b0048b.js"><link rel="prefetch" href="/docs/assets/js/47.3d942c7f.js"><link rel="prefetch" href="/docs/assets/js/48.420529bd.js"><link rel="prefetch" href="/docs/assets/js/49.f854bde9.js"><link rel="prefetch" href="/docs/assets/js/5.fc791712.js"><link rel="prefetch" href="/docs/assets/js/50.20ad1395.js"><link rel="prefetch" href="/docs/assets/js/51.3dffae69.js"><link rel="prefetch" href="/docs/assets/js/52.69cad4b5.js"><link rel="prefetch" href="/docs/assets/js/53.32a1864c.js"><link rel="prefetch" href="/docs/assets/js/54.efff80f8.js"><link rel="prefetch" href="/docs/assets/js/55.c3b5a482.js"><link rel="prefetch" href="/docs/assets/js/56.2f418f1b.js"><link rel="prefetch" href="/docs/assets/js/57.cf625c88.js"><link rel="prefetch" href="/docs/assets/js/58.c245f68e.js"><link rel="prefetch" href="/docs/assets/js/59.4c1b58af.js"><link rel="prefetch" href="/docs/assets/js/6.ffe6f60a.js"><link rel="prefetch" href="/docs/assets/js/60.e180cfdb.js"><link rel="prefetch" href="/docs/assets/js/61.da11dd3e.js"><link rel="prefetch" href="/docs/assets/js/62.9f0232ca.js"><link rel="prefetch" href="/docs/assets/js/63.775069fa.js"><link rel="prefetch" href="/docs/assets/js/64.41e18802.js"><link rel="prefetch" href="/docs/assets/js/65.4b9b2ed8.js"><link rel="prefetch" href="/docs/assets/js/66.1732b332.js"><link rel="prefetch" href="/docs/assets/js/67.24df4364.js"><link rel="prefetch" href="/docs/assets/js/68.e51cbfa8.js"><link rel="prefetch" href="/docs/assets/js/69.057698b5.js"><link rel="prefetch" href="/docs/assets/js/7.9dde9a5b.js"><link rel="prefetch" href="/docs/assets/js/70.866d6698.js"><link rel="prefetch" href="/docs/assets/js/71.a28f6cc4.js"><link rel="prefetch" href="/docs/assets/js/72.4a8be857.js"><link rel="prefetch" href="/docs/assets/js/73.be347096.js"><link rel="prefetch" href="/docs/assets/js/74.f62ea143.js"><link rel="prefetch" href="/docs/assets/js/75.57664e13.js"><link rel="prefetch" href="/docs/assets/js/76.e0fc750f.js"><link rel="prefetch" href="/docs/assets/js/77.1761c6a4.js"><link rel="prefetch" href="/docs/assets/js/78.817e41bb.js"><link rel="prefetch" href="/docs/assets/js/79.dc31416b.js"><link rel="prefetch" href="/docs/assets/js/8.a7519bef.js"><link rel="prefetch" href="/docs/assets/js/80.7df8091c.js"><link rel="prefetch" href="/docs/assets/js/81.c5720713.js"><link rel="prefetch" href="/docs/assets/js/82.96f0bbb7.js"><link rel="prefetch" href="/docs/assets/js/83.d2e7a142.js"><link rel="prefetch" href="/docs/assets/js/84.f117d319.js"><link rel="prefetch" href="/docs/assets/js/85.d9b7171c.js"><link rel="prefetch" href="/docs/assets/js/86.6476be6b.js"><link rel="prefetch" href="/docs/assets/js/87.c4169974.js"><link rel="prefetch" href="/docs/assets/js/88.189fe301.js"><link rel="prefetch" href="/docs/assets/js/89.590922b3.js"><link rel="prefetch" href="/docs/assets/js/9.59f484fb.js"><link rel="prefetch" href="/docs/assets/js/90.52e68be9.js"><link rel="prefetch" href="/docs/assets/js/91.1f6b07a4.js"><link rel="prefetch" href="/docs/assets/js/92.5c453a5c.js"><link rel="prefetch" href="/docs/assets/js/93.42ea2dfa.js"><link rel="prefetch" href="/docs/assets/js/94.3aea1914.js"><link rel="prefetch" href="/docs/assets/js/95.ad01db47.js"><link rel="prefetch" href="/docs/assets/js/96.a5576e39.js"><link rel="prefetch" href="/docs/assets/js/97.9c66933b.js"><link rel="prefetch" href="/docs/assets/js/98.27a355b6.js"><link rel="prefetch" href="/docs/assets/js/99.f1e0a4fc.js">
    <link rel="stylesheet" href="/docs/assets/css/0.styles.148f7da4.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/docs/" class="home-link router-link-active"><!----> <span class="site-name">Nx-website-component</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <!----></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><!---->  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Install</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/docs/chapter1/" class="sidebar-link">Introduction</a></li><li><a href="/docs/chapter1/dev.html" class="sidebar-link">开发</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>NxBg 背景图</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/docs/chapter2/Props&amp;Event.html" class="sidebar-link">使用</a></li><li><a href="/docs/chapter2/demo.html" class="sidebar-link">代码演示</a></li><li><a href="/docs/chapter2/problem.html" class="sidebar-link">遗留问题</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>NxCard 卡片</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/docs/chapter3/entry.html" class="sidebar-link">使用</a></li><li><a href="/docs/chapter3/demo.html" class="sidebar-link">代码演示</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>NxFooter 底部</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/docs/chapter4/entry.html" class="sidebar-link">使用</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>NxArt 文章</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/docs/chapter5/entry.html" class="sidebar-link">使用</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>NxSlide 幻灯片</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/docs/chapter6/entry.html" class="sidebar-link">使用</a></li><li><a href="/docs/chapter6/demo.html" class="sidebar-link">代码演示</a></li><li><a href="/docs/chapter6/feat.html" class="sidebar-link">feat</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>版本记录</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/docs/chapter7/entry.html" class="sidebar-link">修复记录</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>HTTP</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/docs/http/diff.html" class="sidebar-link">http1和http2的区别</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>CSS</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/docs/css/GPU.html" class="sidebar-link">GPU 加速</a></li><li><a href="/docs/css/backflow.html" class="sidebar-link">回流/重塑</a></li><li><a href="/docs/css/props.html" class="sidebar-link">属性</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>渲染优化</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/docs/browser/chapter1.html" class="sidebar-link">渲染优化</a></li><li><a href="/docs/browser/chapter2.html" class="sidebar-link">回流与重绘</a></li><li><a href="/docs/browser/chapter3.html" class="sidebar-link">使用 fastdom 解决布局抖动</a></li><li><a href="/docs/browser/chapter4.html" class="sidebar-link">复合线程与图层</a></li><li><a href="/docs/browser/chapter5.html" class="sidebar-link">避免重绘</a></li><li><a href="/docs/browser/chapter6.html" class="sidebar-link">高频事件防抖</a></li><li><a href="/docs/browser/chapter7.html" class="sidebar-link">React 时间调度的实现</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>HTML&amp;CSS优化</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/docs/htmlOptimization/chapter1.html" class="sidebar-link">HTML &amp; CSS</a></li><li><a href="/docs/htmlOptimization/chapter2.html" class="sidebar-link">CSS contain</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>代码优化</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/docs/jsOptimization/chapter1.html" class="sidebar-link">缩短 JS 解析时间</a></li><li><a href="/docs/jsOptimization/chapter2.html" class="sidebar-link">配合 V8 有效优化代码</a></li><li><a href="/docs/jsOptimization/chapter3.html" class="sidebar-link">函数优化</a></li><li><a href="/docs/jsOptimization/chapter4.html" class="sidebar-link">对象优化</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>资源压缩</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/docs/sourcelOptimization/chapter1.html" class="sidebar-link">图片加载优化</a></li><li><a href="/docs/sourcelOptimization/chapter2.html" class="sidebar-link">字体优化</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Webpack优化</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/docs/webpack/chapter1.html" class="sidebar-link">webpack 优化配置</a></li><li><a href="/docs/webpack/chapter2.html" class="sidebar-link">依赖优化</a></li><li><a href="/docs/webpack/chapter3.html" class="sidebar-link">Code Splitting</a></li><li><a href="/docs/webpack/chapter4.html" class="sidebar-link">资源压缩</a></li><li><a href="/docs/webpack/chapter5.html" class="sidebar-link">Webpack 缓存</a></li><li><a href="/docs/webpack/chapter6.html" class="sidebar-link">webpack 性能检测和分析工具</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>传输加载优化</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/docs/transmission/chapter1.html" class="sidebar-link">启用压缩 GZIP</a></li><li><a href="/docs/transmission/chapter2.html" class="sidebar-link">启用 Keep Alive</a></li><li><a href="/docs/transmission/chapter3.html" class="sidebar-link">HTTP 资源缓存</a></li><li><a href="/docs/transmission/chapter4.html" class="sidebar-link">Service Workers</a></li><li><a href="/docs/transmission/chapter5.html" class="sidebar-link">HTTP2</a></li><li><a href="/docs/transmission/chapter6.html" class="sidebar-link">资源优先加载</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>js</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/docs/js/object.html" class="sidebar-link">Object 属性定义</a></li><li><a href="/docs/js/offset.html" class="sidebar-link">offset 相关属性</a></li><li><a href="/docs/js/client.html" class="sidebar-link">client 相关属性</a></li><li><a href="/docs/js/scroll.html" class="sidebar-link">scroll 相关属性</a></li><li><a href="/docs/js/page.html" class="sidebar-link">page 相关属性</a></li><li><a href="/docs/js/bodyOffset.html" class="sidebar-link">计算元素距离 body 的偏移量</a></li><li><a href="/docs/js/getSize.html" class="sidebar-link">获取隐藏元素宽高值</a></li><li><a href="/docs/js/jwt.html" class="sidebar-link">jwt</a></li><li><a href="/docs/js/notification.html" class="sidebar-link">Notification</a></li><li><a href="/docs/js/getBoundingClientRect.html" class="sidebar-link">Element.getBoundingClientRect</a></li><li><a href="/docs/js/draggable.html" class="sidebar-link">draggable HTML 拖拽</a></li><li><a href="/docs/js/getImgSize.html" class="sidebar-link">获取图片原始尺寸</a></li><li><a href="/docs/js/node.html" class="sidebar-link">NodeType 元素节点属性</a></li><li><a href="/docs/js/fade.html" class="sidebar-link">JS 实现 JQ-fadeIn,fadeout</a></li><li><a href="/docs/js/location.html" class="sidebar-link">URL-location 对象</a></li><li><a href="/docs/js/decode.html" class="sidebar-link">URL 解码和编码</a></li><li><a href="/docs/js/loadingImg.html" class="sidebar-link">渐进式的图片懒加载$</a></li><li><a href="/docs/js/urlSearchParams.html" class="sidebar-link">urlSearchParams</a></li><li><a href="/docs/js/getComputedStyle.html" class="sidebar-link">Window.getComputedStyle</a></li><li><a href="/docs/js/videoToImg.html" class="sidebar-link">上传视频生成缩略图，上传图片生成缩略图</a></li><li><a href="/docs/js/cloneDeep.html" class="sidebar-link">简易深拷贝+对象合并</a></li><li><a href="/docs/js/promise.html" class="sidebar-link">Promise 零碎知识点</a></li><li><a href="/docs/js/bind.html" class="sidebar-link">bind 函数传参</a></li><li><a href="/docs/js/modules.html" class="sidebar-link">ESM和CJS区别</a></li><li><a href="/docs/js/eventLoop.html" class="sidebar-link">EventLoop</a></li><li><a href="/docs/js/requestAnimationFrame.html" class="sidebar-link">requestAnimationFrame &amp; requestIdleCallback</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>红宝书</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/docs/redbook/function.html" class="sidebar-link">Function 类型</a></li><li><a href="/docs/redbook/designMode.html" class="sidebar-link">设计模式</a></li><li><a href="/docs/redbook/packingType.html" class="sidebar-link">基本包装类型</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>web socket</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/docs/socket/pubNabVue.html" class="sidebar-link">pubnub-vue</a></li><li><a href="/docs/socket/hello.html" class="sidebar-link">Demo</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>nodejs</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/docs/nodejs/base.html" class="sidebar-link">基础</a></li><li><a href="/docs/nodejs/zip.html" class="sidebar-link">压缩文件</a></li><li><a href="/docs/nodejs/unZip.html" class="sidebar-link">解压</a></li><li><a href="/docs/nodejs/inspect.html" class="sidebar-link">inspect 协议</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>perfect</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/docs/performance/target.html" class="sidebar-link">性能指标和优化目标</a></li><li><a href="/docs/performance/RAIL.html" class="sidebar-link">RAIL测量标准</a></li><li><a href="/docs/performance/webPageTest.html" class="sidebar-link">WebPageTest</a></li><li><a href="/docs/performance/lightHouse.html" class="sidebar-link">LightHouse分析页面性能</a></li><li><a href="/docs/performance/apis.html" class="sidebar-link">常用性能测量API</a></li><li><a href="/docs/performance/Rendering.html" class="sidebar-link">渲染优化</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>koa</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/docs/koa/chapter1.html" class="sidebar-link">基础</a></li><li><a href="/docs/koa/core.html" class="sidebar-link">简单实现 koa 核心原理</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>vue</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/docs/vue/defineReactive.html" class="sidebar-link">响应式对象</a></li><li><a href="/docs/vue/$nextTick.html" class="sidebar-link">\$nextTick</a></li><li><a href="/docs/vue-source/chapter1.html" class="sidebar-link">New Vue 发生了什么</a></li><li><a href="/docs/vue-source/chapter2.html" class="sidebar-link">Vue 实例挂载实现</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>vue3</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/docs/vue3/chapter1.html" aria-current="page" class="active sidebar-link">ref &amp; reactive</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/docs/vue3/chapter1.html#ref" class="sidebar-link">ref</a></li><li class="sidebar-sub-header"><a href="/docs/vue3/chapter1.html#reactive" class="sidebar-link">reactive</a></li><li class="sidebar-sub-header"><a href="/docs/vue3/chapter1.html#区别" class="sidebar-link">区别</a></li><li class="sidebar-sub-header"><a href="/docs/vue3/chapter1.html#使用" class="sidebar-link">使用</a></li><li class="sidebar-sub-header"><a href="/docs/vue3/chapter1.html#toref和torefs" class="sidebar-link">toRef和toRefs</a></li><li class="sidebar-sub-header"><a href="/docs/vue3/chapter1.html#源码" class="sidebar-link">源码</a></li></ul></li><li><a href="/docs/vue3/chapter2.html" class="sidebar-link">新增</a></li><li><a href="/docs/vue3/chapter3.html" class="sidebar-link">v-model</a></li><li><a href="/docs/vue3/chapter4.html" class="sidebar-link">vuex</a></li><li><a href="/docs/vue3/chapter5.html" class="sidebar-link">axios</a></li><li><a href="/docs/vue-source/chapter3.html" class="sidebar-link">Vue3 reactive 源码</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="ref-reactive"><a href="#ref-reactive" class="header-anchor">#</a> ref &amp; reactive</h1> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p><code>ref</code>和<code>reactive</code>这两者在<code>vue3</code>中都是用来将数据进行响应式的<code>api</code>。
<code>ref</code>通常用于基本数据类型的响应式。
<code>reactive</code>通常用于复制数据类型的响应式。</p></div> <h2 id="ref"><a href="#ref" class="header-anchor">#</a> ref</h2> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> ref <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;vue&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> count <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="reactive"><a href="#reactive" class="header-anchor">#</a> reactive</h2> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> reactive <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;vue&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> countData <span class="token operator">=</span> <span class="token function">reactive</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  count<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
  total<span class="token operator">:</span> <span class="token number">10</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="区别"><a href="#区别" class="header-anchor">#</a> 区别</h2> <h3 id="用法"><a href="#用法" class="header-anchor">#</a> 用法</h3> <ul><li><p><code>ref</code>在函数中需要使用<code>value</code>属性操作，而<code>reactive</code>不需要。</p></li> <li><p><code>reactive</code>直接结构后，结构后的对象就是非响应式的数据了。需要额外对于<code>reactive</code>的数据进行调用<code>toRefs()</code>方法后在进行结构才能保持响应式对象。</p></li></ul> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p><code>reactive</code>直接结构后，解构后的对象就是非响应式的数据了。需要额外对于<code>reactive</code>的数据进行调用<code>toRefs()</code>方法后在进行结构才能保持响应式对象。</p> <p>同理，<code>props</code>传入的对象具有和<code>reactive</code>对象相同的使用方式，对于<code>props</code>整体对象来说和<code>reactive</code>同样是响应式的，但是拆分开来或者解构之后就并非响应式，同样需要使用<code>toRefs</code>对象进行调用后才可以单独使用才可以达到和父元素传递属性响应式。</p></div> <p>比如：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> reactive<span class="token punctuation">,</span> toRefs<span class="token punctuation">,</span> computed <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;vue&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> data<span class="token operator">:</span> DataProps <span class="token operator">=</span> <span class="token function">reactive</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  count<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
  <span class="token function-variable function">increase</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    data<span class="token punctuation">.</span>count<span class="token operator">++</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  double<span class="token operator">:</span> <span class="token function">computed</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> data<span class="token punctuation">.</span>count <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 调用了toRefs后结构的refData中每一项才是响应式的</span>
<span class="token comment">// toRefs方法就相当于对于reactive的对象中的每一项进行调用ref方法</span>
<span class="token keyword">const</span> refData <span class="token operator">=</span> <span class="token function">toRefs</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">return</span> <span class="token punctuation">{</span>
  <span class="token operator">...</span>refData<span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>他俩的区别就好比这段 js 代码进行区别:</p> <ul><li>ref</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> x <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token comment">// 响应式对象</span>
<span class="token keyword">let</span> y <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token comment">// 响应式</span>

<span class="token keyword">function</span> <span class="token function">updateValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  x <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span> <span class="token comment">// 更新原本x的值</span>
  y <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span> <span class="token comment">// 更新原本y的值</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li>reactive</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> object <span class="token operator">=</span> <span class="token punctuation">{</span>
  x<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
  y<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">updateValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  object<span class="token punctuation">.</span>x <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span> <span class="token comment">// 更新object中x的值</span>
  object<span class="token punctuation">.</span>y <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span> <span class="token comment">// 更新object中y的值</span>
<span class="token punctuation">}</span>
</code></pre></div><blockquote><p>所以通过这段代码看出来，如果使用解构<code>reactive</code>对象，或者<code>a=object.x</code>，那么相当于重新生成了一个新的值，原本<code>object</code>中的属性改变就和新的值没有任何关系了，故而也不是响应式对象了。</p></blockquote> <h2 id="使用"><a href="#使用" class="header-anchor">#</a> 使用</h2> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p><code>vue3</code>中关于<code>ref</code>和<code>reactive</code>这两种方式，</p> <p>既可以对于基本类型使用<code>ref</code>，原始类型使用<code>reactive</code>，但是解构时候记得使用<code>toRefs</code>方法保证<code>reactive</code>响应式。</p> <p>当然也可以全部使用<code>reactive</code>，也配合需要<code>toRefs</code>方法。</p> <p>这种没有强制规则，根据自己的编程习惯选择方法。</p> <p>https://juejin.cn/post/6860349065742745613#heading-5</p></div> <blockquote><p>ref 在源代码中其实使用的是 reactive 的代码。所以其实它两确实是可以混用的。</p></blockquote> <blockquote><p>其实它两看成 js 中的 原始类型（ref）和引用类型 （reacitve），**reacitve 而且是不能接受一个原始类型作为参数的。**所以这两个不同的 API 其实创造了两种使用的语境。</p></blockquote> <p><img src="https://i.loli.net/2021/03/04/87yhXMVPErBsDnf.png" alt="企业微信截图_906e74f6-c4ae-4d70-93f6-38dac6a7a012.png"></p> <blockquote><p>额外注意下，<code>composition Api</code>中不存在 <code>created</code>和<code>beforeCreated</code>这两个生命周期，因为<code>setup</code>函数的周期和这两个函数的周期特别相近，所以直接写在<code>setup</code>中就可以了。</p></blockquote> <blockquote><p>onUpdated 在页面数据变化之后就会触发，比如事件触发数据改变页面渲染，或者<code>onMounted</code>中改变数据导致页面刷新也会触发。
<strong>页面数据刷新改变</strong>，首次渲染不会触发<code>onUpdated</code>，所以<code>created</code>中<code>setup</code>中都不会触发的。</p></blockquote> <blockquote><p>vue3 额外增加了两个生命周期，<code>onRenderTracked</code>和<code>onRenderTriggered</code>用于调试，接受一个参数，这个参数可以查看关于数据改变产生渲染的数据详情。</p></blockquote> <h2 id="toref和torefs"><a href="#toref和torefs" class="header-anchor">#</a> <code>toRef</code>和<code>toRefs</code></h2> <h3 id="toref"><a href="#toref" class="header-anchor">#</a> toRef</h3> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>简单理解<code>toRef</code>就是对于对象属性的引用，<code>const result = toRef(target,key)</code>之后<code>result</code>的修改就会映射到<code>target</code>中<code>key</code>的修改。
此时，如果<code>target</code>是响应式对象，那么修改<code>result</code>后<code>target</code>的<code>key</code>改变那么就会更新页面，如果<code>target</code>并不是响应式对象，那么修改<code>result</code>仅仅只会改变<code>target</code>的<code>key</code>值，页面并不会刷新。(原本对象是非响应式)</p> <blockquote><p><code>const result = toRef(object,key)</code>方法，生成引用。实质上修改<code>result.value</code>也就是修改<code>object[key]</code>的值。</p></blockquote></div> <p><code>toRef()</code> 是一个函数，返回一个 <code>ToRef</code> 对象。使用语法是
<code>const result = toRef(target, &quot;key&quot;);</code></p> <ul><li><p>ToRef 对象并不是 Ref 对象；我们通过 ref() 函数创建的对象一定是响应式的数据，数据被修改了，会直接反应在页面上。</p></li> <li><p>ToRef 对象不一定是响应式的数据，这个要看 target 的数据是否是响应式的。</p></li> <li><p>target 如果是响应式对象（reactive 或者 ref 创建的对象）的话，那么 result 也是响应式对象。</p></li></ul> <ul><li>toRef() 函数是对 target 的一种映射；result 的内容修改的时候，target 也会被修改；反过来也是一样的，target 被修改了，result 内容也会被修改。</li></ul> <ul><li><strong>对于<code>reactive object</code>上并不存在的属性，调用<code>toRef(object,key)</code>生成的属性才会是响应式的，<code>toRefs(obj)</code>仅仅会将<code>reactive obj</code>中已有的属性进行响应式劫持。</strong></li></ul> <p>这个用法同样可以在<code>props</code>中使用。当解构<code>props</code>时，由于有一些属性并没有传递初始值。所以调用<code>toRefs</code>解构可能会导致丧失响应式。</p> <p>使用<code>toRef</code>可以很好的解决这个问题。</p> <blockquote><p><code>toRef</code> will return a usable ref even if the source property doesn't currently exist. This makes it especially useful when working with optional props, which wouldn't be picked up by toRefs.(vue3 文档)
即使原本属性上不存在<code>toRef(obj,key)</code>的<code>key</code>，<code>toRef(obj.key)</code>也会返回一个可用的的<code>ref</code>对象。（尤其在没有传入初始化值的<code>props</code>中）</p></blockquote> <p>比如:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">/* toRefs */</span>
<span class="token keyword">const</span> obj <span class="token operator">=</span> <span class="token function">reactive</span><span class="token punctuation">(</span><span class="token punctuation">{</span> name<span class="token operator">:</span> <span class="token string">&quot;wanghaoyu&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> toRefsObj <span class="token operator">=</span> <span class="token function">toRefs</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> age <span class="token operator">=</span> toRefObj<span class="token punctuation">.</span>age<span class="token punctuation">;</span> <span class="token comment">// 原本obj上并不存在age 并不会创建新的响应式属性</span>
age<span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span> <span class="token comment">// 此时并不会触发页面更新</span>

<span class="token comment">/* toRef */</span>
<span class="token keyword">const</span> obj <span class="token operator">=</span> <span class="token function">reactive</span><span class="token punctuation">(</span><span class="token punctuation">{</span> name<span class="token operator">:</span> <span class="token string">&quot;wanghaoyu&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> toRefObj <span class="token operator">=</span> <span class="token function">toRef</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> <span class="token string">&quot;age&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> age <span class="token operator">=</span> toRefObj<span class="token punctuation">.</span>age<span class="token punctuation">;</span> <span class="token comment">// 原本obj上并不存在age,</span>
<span class="token comment">// 但是调用toRef(obj,a)会在obj上创建一个新的响应式属性</span>
age<span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span> <span class="token comment">// 此时会触发页面更新 引用`toRef`也会处理原本对象上不存在的key</span>
</code></pre></div><details class="custom-block details"><summary>DETAILS</summary> <div class="language-vue extra-class"><pre class="language-vue"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>{{ a }} <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>changeA<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>changeA<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>{{ objRef }} <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>change<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>change<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>
    {{ reactiveRef }} <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>changeReactive<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>changeReactive<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>ts<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
<span class="token keyword">import</span> <span class="token punctuation">{</span> toRef<span class="token punctuation">,</span> reactive<span class="token punctuation">,</span> ref <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;vue&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  <span class="token function">setup</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">//普通对象</span>
    <span class="token keyword">const</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span> name<span class="token operator">:</span> <span class="token string">&quot;zhangsan&quot;</span><span class="token punctuation">,</span> age<span class="token operator">:</span> <span class="token number">12</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> objRef <span class="token operator">=</span> <span class="token function">toRef</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> <span class="token string">&quot;name&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//响应式对象</span>
    <span class="token keyword">const</span> a <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token string">&quot;hello&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//响应式对象</span>
    <span class="token keyword">const</span> reactiveObj <span class="token operator">=</span> <span class="token function">reactive</span><span class="token punctuation">(</span><span class="token punctuation">{</span> name<span class="token operator">:</span> <span class="token string">&quot;Willim&quot;</span><span class="token punctuation">,</span> age<span class="token operator">:</span> <span class="token number">6</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> reactiveRef <span class="token operator">=</span> <span class="token function">toRef</span><span class="token punctuation">(</span>reactiveObj<span class="token punctuation">,</span> <span class="token string">&quot;name&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> <span class="token function-variable function">changeA</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">//会响应到页面上</span>
      a<span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token string">&quot;Vue 3.0&quot;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> <span class="token function-variable function">change</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">//会影响 obj 的值，但是不会响应到页面上</span>
      objRef<span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token string">&quot;lisi&quot;</span><span class="token punctuation">;</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> <span class="token function-variable function">changeReactive</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">//会影响 reactiveObj 的值，但是不会响应到页面上</span>
      reactiveRef<span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token string">&quot;lisi&quot;</span><span class="token punctuation">;</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>reactiveObj<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
      objRef<span class="token punctuation">,</span>
      reactiveRef<span class="token punctuation">,</span>
      change<span class="token punctuation">,</span>
      changeReactive<span class="token punctuation">,</span>
      a<span class="token punctuation">,</span>
      changeA<span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>点击 changeA 会立即响应到页面上；点击 change 并不会立即响应到页面；当我们点击 changeReactive 按钮的时候由于改变了响应式的数据，所以会导致 update 页面上的数据，所以 zhangsan 和 Willim 都被更新。</p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>需要注意的是,当页面上触发更新的时候(响应式数据改变更新页面)，此时如果非响应式数据值已经发生了改变，那么也会同步刷新(计算)非响应数据在页面上的值。</p> <p>但是如果仅仅是非响应式数据改变是不会更新页面的，只有响应式改变才会顺道刷新页面，更新非响应式已经改变了的值。</p></div></details> <h3 id="torefs"><a href="#torefs" class="header-anchor">#</a> toRefs</h3> <p><code>toRefs()</code> 函数与 <code>toRef()</code> 很相似。<code>toRef()</code> 剥离的是对象的某个属性，<code>toRefs()</code> 剥离的是对象的所有属性，返回一个新对象。</p> <ul><li><p>toRefs() 函数用法是 <code>const result = toRefs(target);</code> target 的每个属性都会被转换为 ToRef 对象。</p></li> <li><p>同 toRef() 一样，如果原始数据 target 具有响应式的，那么 result 也是响应式；如果 target 是普通对象，那么 result 也是普通对象，不具有响应式。</p></li> <li><p>由于 toRefs() 函数返回的是一个对象，对象每个属性都是 ToRef 对象。我们知道 ... 解构对象是浅拷贝，所以使用 toRefs() 函数，我们可以对响应式的数据进行解构</p></li></ul> <h2 id="源码"><a href="#源码" class="header-anchor">#</a> 源码</h2> <p>我们来看看<code>toRef</code>的源码就能理解<code>toRef</code>和<code>ref</code>的区别了。(<code>toRefs</code>本质上是对<code>reactive</code>对象上所有的属性进行<code>toRef</code>，也会说)。</p> <h3 id="toref-2"><a href="#toref-2" class="header-anchor">#</a> <code>toRef</code></h3> <div class="language-js extra-class"><pre class="language-js"><code>
<span class="token keyword">class</span> <span class="token class-name">ObjectRefImpl</span> <span class="token punctuation">{</span>
    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">_object<span class="token punctuation">,</span> _key</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// object 记录引用</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>_object <span class="token operator">=</span> _object<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>_key <span class="token operator">=</span> _key<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>__v_isRef <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">get</span> <span class="token function">value</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 访问引用对象的属性</span>
        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_object<span class="token punctuation">[</span><span class="token keyword">this</span><span class="token punctuation">.</span>_key<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">set</span> <span class="token function">value</span><span class="token punctuation">(</span><span class="token parameter">newVal</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 修改引用的值</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>_object<span class="token punctuation">[</span><span class="token keyword">this</span><span class="token punctuation">.</span>_key<span class="token punctuation">]</span> <span class="token operator">=</span> newVal<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">toRef</span><span class="token punctuation">(</span><span class="token parameter">object<span class="token punctuation">,</span> key</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">isRef</span><span class="token punctuation">(</span>object<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">)</span>
        <span class="token operator">?</span> object<span class="token punctuation">[</span>key<span class="token punctuation">]</span>
        <span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">ObjectRefImpl</span><span class="token punctuation">(</span>object<span class="token punctuation">,</span> key<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token operator">...</span>


</code></pre></div><p>通过上述代码我们可以看到，对于<code>toRef</code>这个方法，如果传递的<code>object[key]</code>已经是响应式<code>ref</code>对象那么直接返回。如果<code>obj[key]</code>并不是一个响应式，那么会调用<code>new ObjectRefImpl</code>方法创建一个新的对象进行返回。</p> <p>这个新的对象<code>ObjectRefImpl</code>基于这个类进行创建。内部很简单，主要来看<code>value</code>属性的<code>get</code>和<code>set</code>方法。</p> <p>当访问返回对象的<code>value</code>属性时触发<code>get</code>，实质内部访问了<code>toRef(object,key)</code>中传入的<code>object[key]</code>的值，当调用<code>set</code>方法时，实质上等于修改了<code>toRef(object,key)</code>方法中<code>object[key]</code>---<code>object[key]=newValue</code>，修改了原本响应式对象上的值。</p> <blockquote><p>所以才说<code>toRef</code>方法实质上是对于传入对象的引用。</p></blockquote> <p>同时也可以看到<code>toRef</code>对于原本<code>Object</code>上不存在的属性也会创建对应的<code>key</code>(当调用<code>set value</code>时，会在原本<code>reactive object</code>中创建一个新的属性。因为 Vue3 使用 Proxy 监听的是整个对象，所以对于<code>object</code>新增的属性确保了响应式。)</p> <h3 id="torefs-2"><a href="#torefs-2" class="header-anchor">#</a> <code>toRefs</code></h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">toRefs</span><span class="token punctuation">(</span><span class="token parameter">object</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">isProxy</span><span class="token punctuation">(</span>object<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">warn</span><span class="token punctuation">(</span>
      <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">toRefs() expects a reactive object but received a plain one.</span><span class="token template-punctuation string">`</span></span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">const</span> ret <span class="token operator">=</span> <span class="token function">isArray</span><span class="token punctuation">(</span>object<span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token keyword">new</span> <span class="token class-name">Array</span><span class="token punctuation">(</span>object<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> key <span class="token keyword">in</span> object<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    ret<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">toRef</span><span class="token punctuation">(</span>object<span class="token punctuation">,</span> key<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> ret<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>可以看到<code>toRefs</code>源码，传入一个<code>Object</code>。首先检查这个<code>obj</code>是否是一个响应式对象，如果对于一个响应式对象调用<code>toRefs</code>方法会打出一行警告。</p> <p>其实内部也就是对于<code>object</code>每一个<code>key</code>进行<code>toRef</code>属性的调用。</p> <p><code>toRefs</code>对于<code>reactive object</code>中不存在的属性就不会变成响应式，
因为<code>toRefs</code>本质上是对于<code>object</code>属性的遍历，如果不存在那么就不会创建。</p> <blockquote><p>toRef will return a usable ref even if the source property doesn't currently exist. This makes it especially useful when working with optional props, which wouldn't be picked up by toRefs.</p></blockquote></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/docs/vue-source/chapter2.html" class="prev">
        Vue 实例挂载实现
      </a></span> <span class="next"><a href="/docs/vue3/chapter2.html">
        新增
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/docs/assets/js/app.fbbc5710.js" defer></script><script src="/docs/assets/js/2.f0b9337b.js" defer></script><script src="/docs/assets/js/102.e34730af.js" defer></script>
  </body>
</html>
