# 性能指标和优化目标

## Network 瀑布图

![瀑布图.png](https://i.loli.net/2021/01/28/FHpQgcZ75DxvOPC.png)

瀑布图就是将页面资源加载用自上而下的方式表达出来。

- **横向看**

每一行就是一个资源加载的过程，具体停留在某一个瀑布上就会出现
![截屏2021-01-28 下午8.43.41.png](https://i.loli.net/2021/01/28/QOjktzodID2F7pR.png)

实际上`Content Download`下载是最后一个步骤，比如浏览器请求一个资源

**1. Resource Scheduling**

- 首先经过`Queueing`，这一步是浏览器安排资源请求的队列，也就是浏览器发出这次请求所需要的时间。

**2. Connection Start**

- 这一步会经历 DNS 解析，可以看到这个资源 DNS 解析需要的资源。

- Initial connection，也就是 TCP 建立链接的耗时。

- SSL(HTTPS 网站)找到资源后，SSL 原理就是进行 SSL 安全性验证也就是 SSL 协商也会耗时。

**3 Request/Response.**

- 这一步才是发送请求 req 和 res。

- 以及在 req 和 res 中还有非常重要的一步`Waiting (TTFB)`，他表示请求发出到请求回来到底要多久。

> `TTFB`是非常关键的，就比如说资源请求发出去了但是并没有 res 回来，那么浏览器此时就是白屏，带给用户的体验就是白屏。

影响`TTFB`耗时主要是后台的处理能力:比如请求发出后，后台接收到请求再去查库再去处理逻辑就会耗时。

其次就是资源回路网络的情况。

- 最后才是`Content Download`资源下载的时间。（资源的下载会阻塞）

* **竖向看**

竖向看主要看资源加载的同步和异步，资源于资源之间的联系。如果发生了阻塞那么资源就会是串行的，如果是并行那么就会加速渲染。

其次主要就是看横向看比较关键的时间点，`chrome`下只有两根线，一根是`DomContentLoad`蓝色的线(Dom 加载完成)，另一个红色的是`load`事件也就是资源加载完成的事件。

## Lighthouse

对网站进行评分。

Lighthouse 重要的有两个指标。

- **First Contentful Paint**

> 表示页面第一次绘制的事件，对于用户来讲也就是直观的可以看到浏览器不再是白屏。这个耗时。

- **Speed Index**

> google 评分的指数标准，以 4 为区间，4 秒以内表示优秀。

::: tip
网站的性能测试一定要看网站的用途，比如要求一个电商网站有搜索引擎主要的性能指标那是毫无意义的。只能说是一个目标。
:::

## Performance

交互之类的性能优化&查看。

- 交互响应足够快。

::: tip
理论上所有异步请求返回 1s，返回不回来做压缩。如果还是没办法那就做交互上的优化。比如做加载时候的`loading`
:::


::: tip
- Speend Index 指标 4 分界。
- TTFB 请求返回到响应回来开始下载的时间。
- 页面加载时间 红色的线(load 事件)
- 页面首次渲染时间 First Contentful Paint（让用户感知到页面在加载，而不是加载很久直接）
- 交互的影响足够高。
- 动画帧率维持在60FPS。
- 异步请求足够的快，尽量在1s之内。
:::
