# 渲染优化

## 现代浏览器渲染原理 关键渲染路径

![截屏2021-02-01 下午9.03.41.png](https://i.loli.net/2021/02/01/hbGkuzE3Dn1CRTU.png)

渲染流程一共就是这五步。

从用户输入 URL 到页面渲染经历的过程。

1. 通过域名定向到 IP 进行解析。(DNS 解析)
2. TCP 三次握手建立链接。
3. 链接成功，客户端向服务端请求发送资源。
4. 浏览器得到请求的资源开始渲染。
5. 从 html 中构建 DOMTree。(浏览器把文本转化为单个字符，识别尖括号)
6. 构建 CSSOM
7. 结合 CSSOM 和 DOM 构建 RenderTree(比如去掉一些 display 节点)
8. 根据 RenderTree 的尺寸进行布局和绘制。

**关于布局和渲染就会不得不提到关键渲染路径**:

![截屏2021-02-01 下午9.53.46.png](https://i.loli.net/2021/02/01/qnYcTONFuJLMd8X.png)

- `js`这个过程是说通过 JS 实现一些页面的变化的时候，比如说添加一个 DOM 元素，或者使用 js 做动画(通过 css 也可以)，触发视觉变化。

- `style`之后就是通过`style`计算样式，计算新的 css 规则。

- `layout`接下来进入第三步，将每一个计算后的元素的大小和位置进行布局。(回流)

- `paint`然后让浏览器进行绘制，`Paint`这一步是浏览器真正进行绘制画大小画图片画阴影的过程。(重绘)

- `composite`进行复合图层，将不同的图层联系起来。

> `layout`和`paint`是2个关键的性能消耗环节。而l`layout thrashing`发生的根本原因还是不停强制进行layout造成的(**让浏览器不停的强制触发布局-forcedReflow-layoutThrashing**)。

首次渲染必须经过这五个步骤进行处理。之后每一次样式的变化理论上会都会经历。

**但是有一些样式的变化并不会影响布局`layout`和`paint`**,所以浏览器进行了优化，如果是这样的样式那么就不进行`layout`和`paint`，这样就大大加快了渲染速度。（注意日常开发中配合`will-change属性`）
