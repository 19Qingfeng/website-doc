# 缩短 JS 解析时间

用一段相同大小的`javascript`脚本和`png`图片到浏览器上，可以发现`js`的执行时间远远大于同等尺寸的图片。

因为浏览器对于图片的解压特别快，而`js`到最终执行完毕需要经过**编译，解析，执行**这个过程。尤其是`js`解析的过程，这个过程非常耗时。

虽然浏览器解析 js 看起来我们并没有办法去优化它，但是我们可以在代码层面做一些优化去配合浏览器解析。

## 解决方法

### 代码体积方面

- Code Splitting 代码拆分，按需加载。

> 尽可能的提高代码的 code coverage，保证当前页面渲染时仅加载必须的 js 脚本就可以渲染。其他的暂时没有用到的交给`prefetch`和`lazy loading`。

- Tree Shaking 删除无用代码

> 对于一些项目中没有使用过的 js 代码(无用代码)，及时删除减少包体积。

### 代码层面优化

- 避免长任务

* 避免超过`1KB`的行间脚本

> 行间脚本要避免过长，大多数时候使用行间脚本是为了加快首屏的加载。把一些首屏幕的 js 或者 css 行间化，但是这样一定要合理规划。

- 合理通过`rAF`和`rIC`进行调度。

> 通过`requestAnimationFrame`和`requestIdleCallback`进行合理的时间调度。

- 可见不可交互 vs 最小可交互资源集

> 减少初次加载资源量。

![截屏2021-02-05 下午8.52.13.png](https://i.loli.net/2021/02/05/jyfhdK5pCYFrUum.png)

注意一下几个时间节点:

1. First paint
   页面第一次绘制出有意义的东西的时间。

2. First Meaningful Paint
   页面绘制出一些有用的文字或者图片信息。

3. Time to Interactive
   用户可以交互的时间。